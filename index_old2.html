<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FlightBrief Web (Editable)</title>
  <style>
    body { font-family: sans-serif; margin:0; padding:0; }
    nav { display:flex; background:#333; }
    nav button {
      flex:1; padding:1em; border:none;
      color:#fff; background:#333; cursor:pointer;
    }
    nav button.active { background:#555; }
    section { padding:1em; }

    /* ---- Legend Table ---- */
    .legend { border-collapse: collapse; margin-bottom:1em; width:100%; }
    .legend th, .legend td {
      border:1px solid #888; padding:.5em; text-align:center;
    }
    .legend th { background:#ccc; }
    .legend .leg-D  { background:#2e7d32; color:#fff; cursor:pointer; }
    .legend .leg-A1 { background:#80ff00; cursor:pointer; }
    .legend .leg-A2 { background:#ffff00; cursor:pointer; }
    .legend .leg-CA { background:#ffa500; cursor:pointer; }
    .legend .leg-EA { background:#ff0000; color:#fff; cursor:pointer; }

    .def-panel {
      border:1px solid #888; padding:1em; border-radius:4px;
      margin-bottom:1.5em; min-height:3em;
    }

    /* ---- Cards ---- */
    .card { margin-bottom:1em; padding:.75em; border-radius:4px; position:relative; }
    .card .edit-btn {
      position:absolute; top:.5em; right:.5em;
      font-size:.9em; cursor:pointer;
    }
    .cat-D  { background:#2e7d3222; } /* dark‐green @13% */
    .cat-A1 { background:#80ff0077; } /* lime @47% */
    .cat-A2 { background:#ffff0066; } /* yellow @40% */
    .cat-CA { background:#ffa50066; } /* orange @40% */
    .cat-EA { background:#ff000066; } /* red @40% */

    .border {
      background:rgba(0,0,128,0.1); border-radius:4px; padding:.75em;
      margin-bottom:1em; position:relative;
    }

    details { margin:.5em 0; }
    input, textarea { width:100%; box-sizing:border-box; margin:.25em 0; }
    .actions { text-align:right; margin-top:.5em; }
    .actions button { margin-left:.5em; }
  </style>
</head>
<body>
  <nav>
    <button id="airports-tab" class="active">Airports</button>
    <button id="borders-tab">Borders</button>
  </nav>

  <!-- ───── Airports Section ───── -->
  <section id="airports-section">
    <h2>Airports</h2>

    <!-- Legend exactly as in your Specs -->
    <table class="legend">
      <tr>
        <th>Classification</th>
        <td class="leg-D"  data-code="D">D</td>
        <td class="leg-A1" data-code="A1">A1</td>
        <td class="leg-A2" data-code="A2">A2</td>
        <td class="leg-CA" data-code="CA">CA</td>
        <td class="leg-EA" data-code="EA">EA</td>
      </tr>
    </table>

    <!-- Click one of the above to see its definition here -->
    <div id="def-panel" class="def-panel">
      Click a classification above to view its definition and notes.
    </div>

    <div id="airports-container">Loading…</div>
  </section>


  <!-- ───── Borders Section ───── -->
  <section id="borders-section" style="display:none">
    <h2>Borders</h2>
    <div id="borders-container">Loading…</div>
  </section>


  <script>
    // --- Tab Switching ---
    document.getElementById('airports-tab').onclick = () => toggleTab('airports');
    document.getElementById('borders-tab').onclick  = () => toggleTab('borders');
    function toggleTab(tab) {
      document.getElementById('airports-section').style.display = tab==='airports' ? '' : 'none';
      document.getElementById('borders-section' ).style.display = tab==='borders'  ? '' : 'none';
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      document.getElementById(tab+'-tab').classList.add('active');
    }

    // --- Definitions + Notes ---
    const DEFINITIONS = {
      D:  "**Destination Aerodrome (D):** A destination is an aerodrome served by an Emirates scheduled flight. It must be designated as being available for such use in the Emirates Operations Specifications.",
      A1: "**Fully Capable Alternate (A1):** An alternate aerodrome which has all ground-handling capabilities (as approved and accepted by EK Aerodrome Services) and limited engineering capabilities with regard to approved certifying staff (as approved and accepted by Engineering). Captain release or engineering one-off provision is required.",
      A2: "**Fuel & Go / Planning Alternate (A2):** An alternate aerodrome which has limited ground-handling/engineering capabilities with regard to parking stands, Customs/Immigration or other ancillary facilities (as approved and accepted by Engineering/EK Aerodrome Services) however an aircraft can be refuelled and redispatched with passengers/cargo still on board.",
      CA: "**Critical Aerodrome (CA):** A critical aerodrome is an aerodrome to which diversion can be accomplished primarily in support of ETOPS operations and drift-down/depressurisation strategies.",
      EA: "**Emergency Aerodrome (EA):** Aerodromes not meeting any other classification, listed only for rare, dire emergencies where coverage from the above categories is sparse."
    };
    const NOTES = {
      note1: "**Note 1:** D/A1/A2/CA are considered ‘adequate’ aerodromes.",
      note2: "**Note 2:** Medical Diversion to CAs is not recommended due to the limited logistical support for subsequent flight recovery. However CA may be considered, at Commander’s discretion and in consultation with VPNC, in exceptional medical circumstances."
    };

    // attach click handlers to legend cells
    document.querySelectorAll('.legend td').forEach(td=>{
      td.onclick = _ => {
        const code = td.dataset.code;
        const defP = document.getElementById('def-panel');
        defP.innerHTML = `<div>${DEFINITIONS[code]}</div><div style="margin-top:.5em;">${NOTES.note1}</div>${code==='CA'?`<div>${NOTES.note2}</div>`:''}`;
      };
    });


    // --- Data Load + Render ---
    let airportsData, bordersData;
    window.addEventListener('DOMContentLoaded', ()=>{
      Promise.all([
        fetch('airports.json').then(r=>r.json()),
        fetch('borders_cleaned.json').then(r=>r.json())
      ]).then(([a,b])=>{
        airportsData = a;
        bordersData  = b;
        renderAirports();
        renderBorders();
      }).catch(console.error);
    });

    // --- Render Airports ---
    function renderAirports(){
      const c = document.getElementById('airports-container');
      c.innerHTML = '';
      airportsData
        .sort((a,b)=>(a.ICAO||'').localeCompare(b.ICAO||''))
        .forEach((a,i)=>{
          const cls = (a["Class/AIRFIELD CAT/RFF"]||'D').split('/')[0];
          const div = document.createElement('div');
          div.className = `card cat-${cls}`;
          div.innerHTML = `
            <span class="edit-btn" data-idx="${i}">✎ Edit</span>
            <details open>
              <summary><strong>${a.ICAO} — ${a.Name||''}</strong></summary>
              <details><summary>Identifiers</summary>
                IATA: ${a.IATA||'–'}<br/>
                Elevation: ${a.Elevation||'–'}
              </details>
              <details><summary>Operational Details</summary>
                Category/RFF: ${a["Class/AIRFIELD CAT/RFF"]||'–'}<br/>
                Runways: ${a.Rwy||'–'}<br/>
                Approach: ${a.Approach||'–'}<br/>
                CCI: ${a.CCI||'–'}<br/>
                Ops Hrs: ${a["OPS HRS (ATC/ADMIN)"]||'–'}<br/>
                NOTAM: ${a.NOTAM||'–'}
              </details>
              <details><summary>Weather</summary>
                METAR: ${a.latestMetar||'–'}<br/>
                TAF:   ${a.latestTaf||'–'}
              </details>
            </details>
          `;
          c.appendChild(div);
        });
      // edit handlers
      c.querySelectorAll('.edit-btn').forEach(btn=>{
        btn.onclick = e=> editAirport(+e.target.dataset.idx);
      });
    }

    function editAirport(idx){
      const a = airportsData[idx];
      const form = document.createElement('form');
      form.innerHTML = `
        <h3>Edit ${a.ICAO}</h3>
        <label>ICAO<input name="ICAO" value="${a.ICAO}"></label>
        <label>Name<input name="Name" value="${a.Name||''}"></label>
        <label>IATA<input name="IATA" value="${a.IATA||''}"></label>
        <label>Elevation<input name="Elevation" value="${a.Elevation||''}"></label>
        <label>Category/RFF<input name="Class/AIRFIELD CAT/RFF" value="${a["Class/AIRFIELD CAT/RFF"]||''}"></label>
        <label>Runways<textarea name="Rwy">${a.Rwy||''}</textarea></label>
        <label>Approach<input name="Approach" value="${a.Approach||''}"></label>
        <label>CCI<textarea name="CCI">${a.CCI||''}</textarea></label>
        <label>Ops Hrs<input name="OPS HRS (ATC/ADMIN)" value="${a["OPS HRS (ATC/ADMIN)"]||''}"></label>
        <label>NOTAM<textarea name="NOTAM">${a.NOTAM||''}</textarea></label>
        <div class="actions">
          <button type="button" id="cancel">Cancel</button>
          <button type="submit">Save</button>
        </div>
      `;
      const card = document.querySelectorAll('#airports-container .card')[idx];
      card.innerHTML = '';
      card.appendChild(form);

      form.querySelector('#cancel').onclick = () => renderAirports();
      form.onsubmit = e => {
        e.preventDefault();
        new FormData(form).forEach((v,k)=> a[k]=v);
        renderAirports();
      };
    }


    // --- Render Borders ---
    function renderBorders(){
      const c = document.getElementById('borders-container');
      c.innerHTML = '';
      bordersData.forEach((b,i)=>{
        const div = document.createElement('div');
        div.className = 'border';
        div.innerHTML = `
          <span class="edit-btn" data-idx="${i}">✎ Edit</span>
          <details open>
            <summary><strong>${b.waypoint}</strong></summary>
            <details><summary>FIR</summary>${b.fir}</details>
            <details>
              <summary>Notes</summary>
              Requirement: ${b.notes.requirement}<br/>
              Frequency: ${b.notes.frequency.replace(/\n/g,'<br/>')}
              ${b.notes.other?'<br/>Other:'+b.notes.other.replace(/\n/g,'<br/>'):''}
            </details>
          </details>
        `;
        c.appendChild(div);
      });
      c.querySelectorAll('.edit-btn').forEach(btn=>{
        btn.onclick = e=> editBorder(+e.target.dataset.idx);
      });
    }

    function editBorder(idx){
      const b = bordersData[idx];
      const form = document.createElement('form');
      form.innerHTML = `
        <h3>Edit ${b.waypoint}</h3>
        <label>Waypoint<input name="waypoint" value="${b.waypoint}"></label>
        <label>FIR<input name="fir" value="${b.fir}"></label>
        <label>Requirement<textarea name="notes.requirement">${b.notes.requirement}</textarea></label>
        <label>Frequency<textarea name="notes.frequency">${b.notes.frequency}</textarea></label>
        <label>Other<textarea name="notes.other">${b.notes.other||''}</textarea></label>
        <div class="actions">
          <button type="button" id="cancel">Cancel</button>
          <button type="submit">Save</button>
        </div>
      `;
      const card = document.querySelectorAll('#borders-container .border')[idx];
      card.innerHTML = '';
      card.appendChild(form);

      form.querySelector('#cancel').onclick = () => renderBorders();
      form.onsubmit = e => {
        e.preventDefault();
        const fd = new FormData(form);
        b.waypoint = fd.get('waypoint');
        b.fir      = fd.get('fir');
        b.notes.requirement = fd.get('notes.requirement');
        b.notes.frequency   = fd.get('notes.frequency');
        b.notes.other       = fd.get('notes.other');
        renderBorders();
      };
    }
  </script>
</body>
</html>
