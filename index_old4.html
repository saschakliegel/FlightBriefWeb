<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FlightBrief Web (Editable)</title>
  <style>
    body { font-family: sans-serif; margin:0; padding:0; background:#f0f0f0; }
    nav { display:flex; background:#333; }
    nav button {
      flex:1; padding:1em; border:none;
      color:#fff; background:#333; cursor:pointer;
    }
    nav button.active { background:#555; }

    section { padding:1em; }
    h2 { margin-top:0; }

    /* Legend */
    .legend {
      display: flex;
      gap: 1em;
      margin-bottom: 1em;
      align-items: center;
    }
    .legend div {
      display: flex;
      align-items: center;
      gap: 0.3em;
      font-size: 0.9em;
    }
    .legend .box {
      width: 1em; height: 1em;
      border: 1px solid #888;
    }

    /* Cards */
    .card {
      margin-bottom:1em;
      padding:0.75em;
      border-radius:4px;
      background:#fff;
      position: relative;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .card .edit-btn {
      position: absolute; top:0.5em; right:0.5em;
      font-size:0.9em; cursor:pointer;
      color: rgba(0,0,0,0.4);
    }

    /* Airport colours (solid, bright) */
    .airport.cat-D  { background: #228B22; color: #fff; }
    .airport.cat-A1 { background: #7FFF00; color: #000; }
    .airport.cat-A2 { background: #FFFF00; color: #000; }
    .airport.cat-CA { background: #FFA500; color: #000; }
    .airport.cat-EA { background: #FF0000; color: #fff; }

    /* Border cards */
    .border  { background: rgba(0,0,128,0.1); }

    details { margin:0.5em 0; }
    details summary { cursor: pointer; }

    input, textarea { width:100%; box-sizing:border-box; margin:0.25em 0; }
    .actions { text-align:right; margin-top:0.5em; }
    .actions button { margin-left:0.5em; }
  </style>
</head>
<body>
  <nav>
    <button id="airports-tab" class="active">Airports</button>
    <button id="borders-tab">Borders</button>
  </nav>

  <section id="airports-section">
    <h2>Airports</h2>

    <!-- Legend -->
    <div class="legend">
      <div><span class="box" style="background:#228B22"></span>D</div>
      <div><span class="box" style="background:#7FFF00"></span>A1</div>
      <div><span class="box" style="background:#FFFF00"></span>A2</div>
      <div><span class="box" style="background:#FFA500"></span>CA</div>
      <div><span class="box" style="background:#FF0000"></span>EA</div>
    </div>

    <div id="airports-container">Loading…</div>
  </section>

  <section id="borders-section" style="display:none">
    <h2>Borders</h2>
    <div id="borders-container">Loading…</div>
  </section>

  <script>
    // Tabs
    document.getElementById('airports-tab').onclick = () => toggleTab('airports');
    document.getElementById('borders-tab').onclick  = () => toggleTab('borders');
    function toggleTab(tab) {
      document.getElementById('airports-section').style.display = tab==='airports'? '' : 'none';
      document.getElementById('borders-section').style.display  = tab==='borders'?  '' : 'none';
      document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
      document.getElementById(tab+'-tab').classList.add('active');
    }

    // Data holders
    let airportsData, bordersData;

    window.addEventListener('DOMContentLoaded', () => {
      Promise.all([
        fetch('airports.json').then(r=>r.json()),
        fetch('borders_cleaned.json').then(r=>r.json())
      ])
      .then(([a,b]) => {
        airportsData = a;
        bordersData  = b;
        renderAirports();
        renderBorders();
      })
      .catch(console.error);
    });

    // Render Airports
    function renderAirports(){
      const c = document.getElementById('airports-container');
      c.innerHTML = '';
      airportsData
        .sort((a,b)=> (a.ICAO||'').localeCompare(b.ICAO||'') )
        .forEach((a,i)=>{
          // determine class by first part of "Class/AIRFIELD CAT/RFF"
          const cls = (a['Class/AIRFIELD CAT/RFF']||'D').split('/')[0];
          const div = document.createElement('div');
          div.className = `card airport cat-${cls}`;
          div.innerHTML = `
            <span class="edit-btn" data-index="${i}">✎</span>
            <details open>
              <summary><strong>${a.ICAO} — ${a.Name||''}</strong></summary>
              <div>
                <details><summary>Identifiers</summary>
                  IATA: ${a.IATA||'–'}<br/>
                  Elev: ${a.Elevation||'–'}
                </details>
                <details><summary>Ops Details</summary>
                  Cat/RFF: ${a['Class/AIRFIELD CAT/RFF']||'–'}<br/>
                  RWY: ${a.Rwy||'–'}<br/>
                  Approach: ${a.Approach||'–'}<br/>
                  CCI: ${a.CCI||'–'}<br/>
                  OPS HRS: ${a['OPS HRS (ATC/ADMIN)']||'–'}<br/>
                  NOTAM: ${a.NOTAM||'–'}
                </details>
              </div>
            </details>
          `;
          c.appendChild(div);
        });

      // edit handlers (optional)
      c.querySelectorAll('.edit-btn').forEach(btn=>
        btn.onclick = e => alert('Edit airport #' + e.target.dataset.index)
      );
    }

    // Render Borders (unchanged)
    function renderBorders(){
      const c = document.getElementById('borders-container');
      c.innerHTML = '';
      bordersData.forEach((b,i)=>{
        const div = document.createElement('div');
        div.className='card border';
        div.innerHTML=`
          <span class="edit-btn" data-index="${i}">✎</span>
          <details open>
            <summary><strong>${b.waypoint}</strong></summary>
            <details><summary>FIR</summary>${b.fir}</details>
            <details>
              <summary>Notes</summary>
              <strong>Requirement:</strong> ${b.notes.requirement}<br/>
              <strong>Frequency:</strong><br/>${b.notes.frequency.replace(/\n/g,'<br/>')}
              ${b.notes.other ? `<br/><strong>Other:</strong><br/>${b.notes.other.replace(/\n/g,'<br/>')}` : ''}
            </details>
          </details>
        `;
        c.appendChild(div);
      });
      c.querySelectorAll('.edit-btn').forEach(btn=>
        btn.onclick = e => alert('Edit border #' + e.target.dataset.index)
      );
    }
  </script>
</body>
</html>
